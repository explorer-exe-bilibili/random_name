# UI编辑模式集成完成

## 功能概述

已成功将Button编辑模式功能集成到Screen系统中，现在所有Screen子类都自动支持运行时UI编辑功能。

## 主要功能

### 1. 编辑模式操作
- **F2键**: 切换编辑模式开/关
- **F3键**: 重置当前屏幕的按钮布局到默认状态

### 2. 鼠标编辑操作
- **点击按钮内部**: 开始移动按钮
- **点击编辑手柄**: 调整按钮大小（8个调整点：4个角落 + 4个边框中点）
- **拖拽**: 实时预览变化
- **释放鼠标**: 自动保存布局到配置文件

### 3. 视觉反馈
- 编辑模式下显示蓝色边框
- 8个白色边框的蓝色调整手柄
- 实时拖拽预览

### 4. 布局管理
- 每个屏幕的布局独立保存
- 支持最小尺寸限制（默认10x10像素）
- 支持屏幕边界限制
- 自动保存到配置文件
- 重启程序后布局自动加载

## 修改的文件

### 头文件修改
1. **include/core/baseItem/Button.h**
   - 添加编辑模式相关的方法声明
   - 修改SetRegion和resetRegion方法以支持编辑手柄更新

2. **include/core/screen/base.h**
   - 添加编辑模式相关成员变量
   - 添加编辑模式相关方法声明

3. **include/mainloop.h**
   - 添加MouseMoveEvent回调函数声明

### 源文件修改
1. **src/core/baseItem/Button.cpp**
   - 实现完整的编辑模式功能
   - 添加SetEditMode和SetOnEditComplete方法实现

2. **src/core/screen/base.cpp**
   - 修改Click方法支持编辑模式
   - 修改Draw方法绘制编辑覆盖层
   - 实现布局保存/加载/重置功能

3. **src/mainloop.cpp**
   - 修改KeyEvent函数添加F2/F3快捷键
   - 修改MouseButtonEvent函数支持编辑模式
   - 添加MouseMoveEvent函数处理拖拽

4. **src/main.cpp**
   - 注册鼠标移动回调函数

## 配置文件结构

布局数据保存在配置文件中，格式如下：
```json
{
  "screen_0_exit": {
    "x": 0.9,
    "y": 0.05,
    "width": 0.08,
    "height": 0.06
  },
  "screen_0_button_0": {
    "x": 0.1,
    "y": 0.2,
    "width": 0.2,
    "height": 0.1
  }
}
```

## 使用方法

### 开发者使用
1. 编译项目
2. 运行程序
3. 按F2进入编辑模式
4. 拖拽按钮调整布局
5. 按F2退出编辑模式
6. 按F3重置布局（如需要）

### 最终用户使用
- 提供一个设置选项来启用/禁用编辑模式
- 可以在设置中添加"重置所有布局"按钮

## 技术特性

### 安全性
- 所有编辑操作都有边界检查
- 最小尺寸限制防止按钮消失
- 线程安全的实现

### 性能
- 只在编辑模式下绘制编辑覆盖层
- 高效的事件处理
- 最小化不必要的重绘

### 兼容性
- 无侵入性设计，现有代码无需修改
- 所有Screen子类自动继承编辑功能
- 向后兼容现有配置文件

## 扩展可能

1. **添加网格对齐功能**
2. **支持多选和批量操作**
3. **添加撤销/重做功能**
4. **导入/导出布局模板**
5. **添加更多调整手柄样式**

## 编译后测试

编译完成后，运行程序并测试以下功能：

1. 正常模式下按钮点击功能正常
2. 按F2进入编辑模式，按钮周围出现蓝色边框和调整手柄
3. 拖拽按钮内部可以移动按钮
4. 拖拽调整手柄可以改变按钮大小
5. 按F2退出编辑模式，编辑覆盖层消失
6. 重启程序，布局保持之前的修改
7. 按F3可以重置布局到默认状态

所有功能已集成完毕，可以直接编译和使用！
